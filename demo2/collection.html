<!DOCTYPE html>
<html>
<head>
<title>the5fire-backbone-model</title>
</head>
<body>
</body>
<script src="http://the5fireblog.b0.upaiyun.com/staticfile/jquery-1.10.2.js"></script>
<script src="http://the5fireblog.b0.upaiyun.com/staticfile/underscore.js"></script>
<script src="http://the5fireblog.b0.upaiyun.com/staticfile/backbone.js"></script>
<script>
(function ($) {
    //注意这里
    var Book = Backbone.Model.extend({

    defaults : {
        title:'default'
    },

    initialize: function(){
        //alert('Hey, you create me!');
    }

	});

	var BookShelf = Backbone.Collection.extend({
	    model : Book
	});

	var book1 = new Book({title : 'book1'});
	var book2 = new Book({title : 'book2'});
	var book3 = new Book({title : 'book3'});

	//注意这里面是数组,或者使用add
	//var bookShelf = new BookShelf([book1, book2, book3]);

	var bookShelf = new BookShelf;

	bookShelf.add(book1);
	bookShelf.add(book2);
	bookShelf.add(book3);
	bookShelf.remove(book3);


	//基于underscore这个js库，还可以使用each的方法获取collection中的数据
	bookShelf.each(function(book){
	    alert(book.get('title'));
	});




	//这里是 collection  获取server  数据
	bookShelf.url = '/books/';
	bookShelf.fetch({
	    success:function(collection, response, options){
	        collection.each(function(book){
	            alert(book.get('title'));
	        });
	    },error:function(collection, response, options){
	        alert('error');
	    }
	});


	//collection在fetch到数据之后，
	//默认情况会调用set方法
	//set方法通过传递模型列表执行一个集合的"smart(智能)"的更新。 如果列表中的一个模型尚不在集合中，那么它将被添加; 如果模型已经在集合中，
	//其属性将被合并; 并且如果集合包含不存在于列表中的任何模型，他们将被删除。 以上所有将触发相应的"add", "remove", 和 "change"事件。 返回集合中的模型。 如果您想自定义的行为， 你可以设置选项：{add: false}, {remove: false}, 
	//或 {merge: false}，将其禁用。

	//可以通过参数{reset: true}来手动触发reset，
	//reset会整个清空collection重新添加所有model  只触发一次。
	var showAllBooks = function(){
    bookShelf.each(function(book){
        //将book数据渲染到页面的操作。
        document.writeln(book.get('title'));
    });
	}

	bookShelf.bind('reset',showAllBooks);
	bookShelf.url = '/books/'; //注意这里
	bookShelf.fetch({
	    // 需要主动传递reset，才会触发reset
	    reset: true,
	    success:function(collection, response, options){
	        collection.each(function(book){
	            alert(book.get('title'));
	        });
	    },error:function(collection, response, options){
	        alert('error');
	    }
	});


})(jQuery);
</script>
</html>